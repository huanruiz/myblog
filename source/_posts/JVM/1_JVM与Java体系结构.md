---
title: JVM|JVM与Java体系结构
date: 2020/6/22
categories: 
- 学习笔记
- JVM
tags: [JVM]
---

学习Java不得不了解JVM, 在这一周我会结合宋红康老师的JVM课程, 总结内存与垃圾回收相关的笔记.
<!-- more -->

Java的垃圾回收使得开发效率大大提升(对比C++), 但是理解JVM工作机制才能更好地让我们我们有扩展知识和debug的能力. Java虚拟机不一定只是支持Java的, 不同的编程语言通过编译器转化成遵从Java虚拟机规范的**字节码文件**, 都可以解释运行.

**JVM是程序虚拟机**, 而VMware属于系统虚拟机. 时二进制字节码的运行环境. 可以一次编译到处运行, 有自动内存管理, 自动垃圾回收功能. 主要结构如下图:
![](/image/jvm1_1.png)

一般来说第一次编译是吧源文件编译成字节码文件, 第二次是把字节码文件中的字节指令编译成机器指令, 并把机器指令缓存起来, 放在方法区中. JIT编译器可以通过这种方式提高性能.
![](/image/jvm1_2.png)

**Java编译器输入的指令流基本上是一种基于栈的指令集架构**. 相对于基于寄存器的, 指令会多一点, 我觉得寄存器指令和以前好奇尝试用汇编控制8位单片机的感觉有点类似. 但是基于栈的指令集架构跨平台型好, 指令集小, 编译器容易实现.

**JVM的生命周期**包含启动(通过bootstrap class loader创建initial class), 执行(执行Java虚拟机的进程), 退出(正常结束, 异常或错误导致终止, 调用了Runtime类或System类exit()方法, 或Runtime类halt()方法结束了进程).

JVM有很多种, 现在在用的一般就是HotSpot, 顾名思义它具有热点代码探测技术. 国内还有阿里开发的AliJVM.